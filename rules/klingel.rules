var DateTime lastRing

rule "Startup"
when
    System started
then
    logInfo("Klingel","Setzte lastRing auf " + now)
			
	lastRing = now
end

rule "Klingel"
	when
		Item Klingel changed to ON
	then
			if(lastRing.isBefore(now.minusSeconds(10))) {
				lastRing = now
				sendCommand(FlurBlinken, ON)
				if (KlingelStumm.state == OFF) {
					sendCommand(mihome_gateway_7c49ebb1dc1b_volume, 25)
					sendCommand(mihome_gateway_7c49ebb1dc1b_sound, 10)
				}
				sendTelegramPhoto("bot2", "http://192.168.178.31/snapshot.cgi?user=openhab&pwd=openhab", "Es klingelt")		
				if (KlingelStumm.state == OFF) {
					Thread::sleep(5000) /* wait for 5 seconds */
					sendCommand(mihome_gateway_7c49ebb1dc1b_sound, 10000)
					sendCommand(mihome_gateway_7c49ebb1dc1b_volume, 0)
				}
				sendCommand(Klingel, OFF)
			}
    end

rule "FlurBlinken"
	when
		Item FlurBlinken changed to ON
	then
		sendCommand(LichterFlur, ON)
		sendCommand(mihome_gateway_7c49ebb1dc1b_brightness, ON)
		Thread::sleep(2000) /* wait for 1 seconds */
		sendCommand(LichterFlur, OFF)
		sendCommand(mihome_gateway_7c49ebb1dc1b_brightness, OFF)
		
		Thread::sleep(2000) /* wait for 1 seconds */
		sendCommand(LichterFlur, ON)
		sendCommand(mihome_gateway_7c49ebb1dc1b_brightness, ON)
		
		Thread::sleep(2000) /* wait for 1 seconds */
		sendCommand(LichterFlur, OFF)
		sendCommand(mihome_gateway_7c49ebb1dc1b_brightness, OFF)
		
		Thread::sleep(2000) /* wait for 1 seconds */
		sendCommand(LichterFlur, ON)
		sendCommand(mihome_gateway_7c49ebb1dc1b_brightness, ON)
		Thread::sleep(2000) /* wait for 1 seconds */
		sendCommand(LichterFlur, OFF)
		sendCommand(mihome_gateway_7c49ebb1dc1b_brightness, OFF)
		
		sendCommand(FlurBlinken, OFF)
	end